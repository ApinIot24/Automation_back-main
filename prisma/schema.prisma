generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model address {
  id                Int       @id @default(autoincrement())
  rak               String    @unique @db.VarChar(255)
  qty_max           Int
  sku_id            Int?
  status            Int       @default(0)
  created_at        DateTime  @default(now()) @db.Timestamp(6)
  qty_current       Int       @default(0)
  updated_at        DateTime  @default(now()) @db.Timestamp(6)
  forceClosedAt     DateTime?
  forceClosedBy     String?
  forceClosedReason String?
  sku               sku?      @relation(fields: [sku_id], references: [id])
  pallets           pallets[]

  @@index([rak])
  @@index([sku_id])
  @@index([status])
}

model alarm_schedule_settings {
  id          Int      @id @default(autoincrement())
  day_of_week Int      @unique
  shift_type  String?  @db.VarChar(20)
  times       Json
  enabled     Boolean  @default(true)
  created_at  DateTime @default(now()) @db.Timestamp(6)
  updated_at  DateTime @db.Timestamp(6)
  created_by  Int?
  updated_by  Int?

  @@index([day_of_week])
  @@index([enabled])
  @@index([shift_type])
}

model log_history {
  id          Int      @id @default(autoincrement())
  userId      Int?
  entity      String
  entityId    String?
  action      String
  description String?
  metadata    Json?
  created_at  DateTime @default(now()) @db.Timestamp(6)

  @@index([created_at])
  @@index([userId])
}

model notification_preferences {
  id                     Int      @id @default(autoincrement())
  user_id                Int      @unique
  notifications_email    Boolean  @default(true)
  notifications_phone    Boolean  @default(true)
  pallet_waiting_email   Boolean  @default(true)
  pallet_waiting_phone   Boolean  @default(true)
  qr_generated_email     Boolean  @default(false)
  qr_generated_phone     Boolean  @default(false)
  print_error_email      Boolean  @default(true)
  print_error_phone      Boolean  @default(true)
  pickup_completed_email Boolean  @default(false)
  pickup_completed_phone Boolean  @default(false)
  qc_completed_email     Boolean  @default(false)
  qc_completed_phone     Boolean  @default(false)
  created_at             DateTime @default(now()) @db.Timestamp(6)
  updated_at             DateTime @db.Timestamp(6)
  users                  users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model notifications {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    Int
  title      String   @db.VarChar(255)
  message    String
  type       String   @default("info") @db.VarChar(20)
  read       Boolean  @default(false)
  action_url String?  @db.VarChar(500)
  metadata   Json?
  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @db.Timestamp(6)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([read])
  @@index([type])
  @@index([user_id])
}

model pallets {
  karton             Int                  @default(0)
  tanggal            DateTime             @db.Date
  created_at         DateTime             @default(now()) @db.Timestamp(6)
  username           String               @db.VarChar(100)
  description        String?              @db.VarChar(255)
  nama_rak           String               @db.VarChar(100)
  nama_sku           String               @db.VarChar(100)
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  address_id         Int?
  karton_awal        Int?
  parent_id          String?              @db.Uuid
  status_pengambilan Int?
  updated_at         DateTime             @db.Timestamp(6)
  status             Int                  @default(1)
  shift_code         Int                  @default(1)
  code_display       String?              @db.VarChar(100)
  spe_item_id        Int?
  pallet_code        Int
  address            address?             @relation(fields: [address_id], references: [id])
  pallets            pallets?             @relation("palletsTopallets", fields: [parent_id], references: [id], onDelete: Cascade)
  other_pallets      pallets[]            @relation("palletsTopallets")
  spe_item           spe_item?            @relation(fields: [spe_item_id], references: [id])
  pengambilan_pallet pengambilan_pallet[]

  @@unique([nama_sku, pallet_code, tanggal, shift_code])
  @@index([address_id])
  @@index([nama_rak])
  @@index([nama_sku])
  @@index([pallet_code])
  @@index([parent_id])
  @@index([status])
  @@index([status_pengambilan])
  @@index([tanggal])
  @@index([username])
}

model pengambilan_pallet {
  id            Int      @id @default(autoincrement())
  pallet_id     String   @db.Uuid
  jumlah_karton Int
  sisa_karton   Int?
  status        Int
  tanggal       DateTime @default(now()) @db.Timestamp(6)
  username      String   @db.VarChar(100)
  keterangan    String?  @db.VarChar(255)
  pallets       pallets  @relation(fields: [pallet_id], references: [id], onDelete: Cascade)

  @@index([pallet_id])
  @@index([status])
  @@index([tanggal])
  @@index([username])
}

model permissions {
  id               Int                @id @default(autoincrement())
  permission_name  String             @unique @db.VarChar(100)
  role_permissions role_permissions[]
}

model push_subscriptions {
  id          Int      @id @default(autoincrement())
  user_id     Int
  endpoint    String
  p256dh      String   @db.VarChar(255)
  auth        String   @db.VarChar(255)
  device_info Json?
  created_at  DateTime @default(now()) @db.Timestamp(6)
  updated_at  DateTime @db.Timestamp(6)
  users       users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([endpoint])
  @@index([user_id])
}

model role_permissions {
  role_id       Int
  permission_id Int
  permissions   permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade)
  roles         roles       @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([role_id, permission_id])
}

model roles {
  id               Int                @id @default(autoincrement())
  role_name        String             @unique @db.VarChar(50)
  role_permissions role_permissions[]
  user_roles       user_roles[]
}

model shift_config {
  id          Int         @id @default(autoincrement())
  shift1Start String
  shift1End   String
  shift2Start String?
  shift2End   String?
  shift3Start String?
  shift3End   String?
  type        ShiftConfig
}

model sku {
  id         Int        @id @default(autoincrement())
  nama_sku   String     @unique @db.VarChar(255)
  created_at DateTime   @default(now()) @db.Timestamp(6)
  updated_at DateTime   @default(now()) @db.Timestamp(6)
  no_sku     Int?
  address    address[]
  spe_item   spe_item[]

  @@index([nama_sku])
}

model spe_header {
  id           Int            @id @default(autoincrement())
  shipment_no  String
  loading_date DateTime
  transporter  String?
  destination  String?
  created_at   DateTime       @default(now())
  updated_at   DateTime       @default(now())
  spe_item     spe_item[]
  spe_timeline spe_timeline[]
}

model spe_item {
  id               Int            @id @default(autoincrement())
  spe_header_id    Int
  sku_id           Int
  description      String?
  stlc             String?
  specification    String?
  quantity         Int
  quantity_loading String
  created_at       DateTime       @default(now())
  updated_at       DateTime       @default(now())
  pallets          pallets[]
  sku              sku            @relation(fields: [sku_id], references: [id])
  spe_header       spe_header     @relation(fields: [spe_header_id], references: [id])
  spe_timeline     spe_timeline[]

  @@index([sku_id])
  @@index([spe_header_id])
}

model spe_timeline {
  id            Int        @id @default(autoincrement())
  spe_header_id Int
  spe_item_id   Int?
  title         String     @db.VarChar(200)
  description   String?    @db.VarChar(500)
  username      String     @db.VarChar(100)
  created_at    DateTime   @default(now()) @db.Timestamp(6)
  spe_header    spe_header @relation(fields: [spe_header_id], references: [id], onDelete: Cascade)
  spe_item      spe_item?  @relation(fields: [spe_item_id], references: [id])

  @@index([spe_header_id])
  @@index([spe_item_id])
}

model user_roles {
  user_id Int
  role_id Int
  roles   roles @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users   users @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, role_id])
}

model users {
  id                       Int                       @id @default(autoincrement())
  username                 String                    @unique @db.VarChar(50)
  email                    String                    @unique @db.VarChar(100)
  password_hash            String
  first_name               String                    @db.VarChar(100)
  last_name                String                    @db.VarChar(100)
  email_verified_at        DateTime?                 @db.Timestamp(6)
  created_at               DateTime?                 @default(now()) @db.Timestamp(6)
  updated_at               DateTime?                 @db.Timestamp(6)
  photo                    String?                   @db.VarChar(255)
  status                   Int?
  notification_preferences notification_preferences?
  notifications            notifications[]
  push_subscriptions       push_subscriptions[]
  user_roles               user_roles[]
}

enum ShiftConfig {
  normal
  short
  custom
}
